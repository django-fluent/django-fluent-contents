{% load i18n admin_urls placeholder_admin_tags %}{% comment %}
  This is the admin template to render the PlaceholderFieldInline.

  It includes the placeholder inline fields, and initialisation code,
  so the placeholder editor can do it's work. The 'domnode' div elements
  are generated by the PlaceholderFieldWidget instances in the form.
{% endcomment %}
<script type="text/javascript">
  // Pass database data to the cp_admin.js file.
  // Each tab hosts a placeholder pane.
  var placeholder_metadata = {% block js_placeholders %}[ {% for inline_admin_form in inline_admin_formset %}{% with form=inline_admin_form.form placeholder=inline_admin_form.original %}{% if not forloop.last %}{% if not forloop.first %}, {% endif %}{
    id: {% if placeholder and placeholder.id %}{{ placeholder.id }}{% else %}''{% endif %},{# if test added to support TEMPLATE_STRING_IF_INVALID #}
    slot: '{{ form.slot.value|default:forloop.counter0|escapejs }}',
    title: '{{ form.title.value|default:"?"|escapejs }}',
    role: '{{ form.role.value|default:'?' }}',
    domnode: 'cp-placeholderfield-{{ form.slot.value|default:forloop.counter0|slugify }}'
  }{% endif %}
    {% endwith %}{% endfor %}]{% endblock %};
  var contentitem_metadata = {% block js_contentitemtypes %}{ {% for fs in inline_admin_formsets|only_content_item_formsets %}'{{ fs.opts.type_name|escapejs }}': {
    type: '{{ fs.opts.type_name|escapejs }}',{# fs.opts = BaseContentItemInline #}
    name: '{{ fs.opts.name|escapejs }}',
    plugin: '{{ fs.opts.plugin.name|escapejs }}',
    prefix: '{{ fs.formset.prefix|escapejs }}',{# fs.formset = targetobjectformFormSet #}
    rel_name: '{{ fs.formset.rel_name|escapejs }}',
    auto_id: '{{ fs.formset.auto_id|escapejs }}'
  }{% if not forloop.last %}, {% endif %}
  {% endfor %}}{% endblock %};
  cp_data.set_placeholders( placeholder_metadata );
  cp_data.set_contentitem_metadata( contentitem_metadata );
</script>

<div id="{{ inline_admin_formset.formset.prefix }}-group"
     class="inline-group inline-placeholder-group" style="display: none;"{% if original %}
     data-get-placeholder-data-url="{% url opts|admin_urlname:'get_placeholder_data' original.pk %}"{% endif %}>
  {{ inline_admin_formset.formset.management_form }}
  {{ inline_admin_formset.formset.non_form_errors }}

  {# all the region tabs #}
  {% for inline_admin_form in inline_admin_formset %}
    {% if inline_admin_form.form.errors %}{# Should never happen, but when it does, this aids debugging #}
      <ul class="errorlist"><li>{{ inline_admin_form.form.errors.as_text|linebreaksbr }}</li></ul>
    {% endif %}

    <!-- placeholder fields -->
    {% if inline_admin_form.has_auto_field or inline_admin_form.needs_explicit_pk_field %}{{ inline_admin_form.pk_field.field }}{% endif %}
    {{ inline_admin_form.fk_field.field }}

    {% for fieldset in inline_admin_form %}{% for line in fieldset %}{% for adminfield in line %}{{ adminfield.field.as_hidden }}
    {% endfor %}{% endfor %}{% endfor %}

  {% endfor %}
</div>
